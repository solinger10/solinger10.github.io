<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">

    <title></title>
    <meta name="description" content="">
    <meta name="author" content="">

    <link rel="stylesheet" href="../src/jquery.typeahead.css">

    <script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
    <!--script src="../dist/jquery.typeahead.min.js"></script-->
    <script src="../src/jquery.typeahead.js"></script>

</head>
<body>

<div style="width: 100%; max-width: 800px; margin: 0 auto;">

    <h1>Template Demo</h1>

    <ul>
        <li>
            <a href="http://www.runningcoder.org/jquerytypeahead/documentation/">Documentation</a>
        </li>
        <li>
            <a href="http://www.runningcoder.org/jquerytypeahead/demo/">Demos</a>
        </li>
    </ul>

    <form>
        <div class="typeahead__container">
            <div class="typeahead__field">

            <span class="typeahead__query">
                <input class="js-typeahead-input"
                       name="q"
                       type="search"
                       autofocus
                       autocomplete="off">
            </span>
            <span class="typeahead__button">
                <button type="submit">
                    <span class="typeahead__search-icon"></span>
                </button>
            </span>

            </div>
        </div>
    </form>

    <script>

$.typeahead({
    input: ".js-typeahead-input",
    minLength: 1,
    order: "asc",
    group: true,
    maxItemPerGroup: 3,
    groupOrder: function () {
        var scope = this, sortGroup = [];
        for (var i in this.result) {
            sortGroup.push({
                group: i,
                length: this.result[i].length
            });
        }
        sortGroup.sort(scope.helper.sort(["length"], false, function (a) {
            return a.toString().toUpperCase()
        }));
        return $.map(sortGroup, function (val, i) {
            return val.group
        });
    },
    hint: true,
    template: "{{name}}, {{group}}",
    emptyTemplate: "no result for {{query}}",
    dynamic: true,
    source: {
        branchName: {
            display: "name",
            data: [{
                "id": 415849,
                "name": "Bhp"
            }, {
                "id": 415859,
                "name": "Bbct"
            }],
            ajax: function (query) {

                var data = {
                    lang: 'fr',
                    addr: '{{query}}',
                    format: 'json'
                };
                var url = "getBranchNames.json";

                if (query == "aa") {
                    data.coucou = "coucou";
                    data.addr = "tests";
                    url = "coucou.json"
                }

                return {
                    type: "GET",
                    url: url,
                    data: data,
                    callback: {
                        done: function (data) {
                            console.log(JSON.stringify(data));
                            return data;
                        }
                    }
                }
            }
        }
    },
    onClickAfter: function (node, a, item, event) {
        event.preventDefault();
    }
    ,
    callback: {
        onResult: function (node, query, obj, objCount) {
            console.log(objCount)
            var text = "";
            if (query !== "") {
                text = objCount + ' elements matching "' + query + '"';
            }
        }
    },
    debug: true
});

    </script>

</div>

</body>
</html>